<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <title>
        AlfaBeta Research
    </title>

    <link rel="stylesheet" href="./style/style.css" type="text/css" media="screen"/>

    <!--[if IE]>
    <link rel="stylesheet" href="./style/ie.css" type="text/css" media="all" />
    <![endif]-->
    <!--[if lt IE 7]>
    <link rel="stylesheet" href="./style/ie6.css" type="text/css" media="all" />
    <![endif]-->
    <!--[if lt IE 8]>
    <script src="../script/IE8.js" type="text/javascript"></script>
    <![endif]-->


</h:head>
<h:body>
    <a name="top" id="top"></a>
    <h:form prependId="false" styleClass="classicform" id="form1">
    <div id="container" class="main">

        <div id="wrapper">
            <p:outputPanel id="login" deferred="true" rendered="#{verificatorController.step eq -1}">
                <p:outputPanel>
                    <p:dialog header="System Access" widgetVar="logindlg" modal="true" height="50"
                              resizable="false" closable="false" visible="true">
                        <p:outputPanel styleClass="p">
                            <p:inputText value="#{verificatorController.key}" styleClass="field" style="width: 300px" />
                        </p:outputPanel>

                        <f:facet name="footer">
                            <div align="center"><p:commandButton value="Enter" action="#{verificatorController.login}" update=":form1" oncomplete="logindlg.hide();"/></div>
                        </f:facet>
                    </p:dialog>
                </p:outputPanel>
            </p:outputPanel>
            <div id="content" class="#{verificatorController.step lt 0 ? 'blur' : ''}">
                <div class="fix">

                    <div class="left">

                        <div id="quicknav">
                            <div class="navR">
                                <p:commandLink actionListener="#{verificatorController.next}" rel="prev" rendered="#{verificatorController.step lt 4}" update=":form1"> </p:commandLink>
                            </div>
                            <div class="navL">
                                <p:commandLink actionListener="#{verificatorController.back}" rel="prev" rendered="#{verificatorController.step gt 0}" update=":form1"> </p:commandLink>
                            </div>
                        </div>

                        <h2>
                            <a href="#" class="verificator">Verificator</a>
                        </h2>

                        <p:outputPanel id="submenu" deferred="true" rendered="#{verificatorController.step >= 0}">
                                <ul class="nav">
                                    <li class="page_item #{verificatorController.step eq 0 ? 'current_page_item' : ' '}"><p:commandLink update=":form1" actionListener="#{verificatorController.setStep(0)}">Algorithm</p:commandLink></li>
                                    <li class="page_item #{verificatorController.step eq 1 or verificatorController.step eq 2 ? 'current_page_item' : ' '}"><p:commandLink update=":form1" actionListener="#{verificatorController.setStep(1)}">DataSet</p:commandLink></li>
                                    <li class="page_item #{verificatorController.step eq 3 ? 'current_page_item' : ' '}"><p:commandLink update=":form1" actionListener="#{verificatorController.setStep(3)}">Results</p:commandLink></li>
                                </ul>
                        </p:outputPanel>
                        <div class="entry">
                            <p:outputPanel id="view" deferred="true">
                                <!-- // Contenido -->
                                <p:outputPanel id="view1" deferred="true" rendered="#{verificatorController.step eq 0}">
                                    <div class="tablewrapper">
                                        <span class="instructions">Select the algorithm to use:</span>
                                        <p:dataTable var="algorithm" value="#{verificatorController.algorithmModel}" id="resultValidation"
                                                     styleClass="ituns border"
                                                     paginator="true" rows="10"
                                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                                     paginatorPosition="bottom"
                                                     selection="#{verificatorController.selectedAlgorithm}">
                                            <p:column selectionMode="single" style="width:2%" />
                                            <p:column>
                                                <f:facet name="header">Name</f:facet>
                                                #{algorithm.name}
                                            </p:column>
                                            <p:column>
                                                <f:facet name="header">Description</f:facet>
                                                #{algorithm.information.getField('TITLE')}
                                            </p:column>
                                            <p:column>
                                                <f:facet name="header">Type</f:facet>
                                                #{algorithm.information.getField('TYPE')}
                                            </p:column>
                                            <p:column>
                                                <f:facet name="header">Category</f:facet>
                                                #{algorithm.information.getField('CATEGORY')}
                                            </p:column>
                                            <p:column>
                                                <f:facet name="header">Action</f:facet>
                                                <p:commandLink oncomplete="#{algorithm.name}dlg.show()" update=":form2:configs#{algorithm.name}" icon="ui-icon-search"
                                                               value="Configure" rendered="#{(algorithm.name eq 'mNN') || (algorithm.name eq 'kNN')}">
                                                    <f:setPropertyActionListener value="#{algorithm}" target="#{verificatorController.configureAlgorithm}" />
                                                </p:commandLink>
                                            </p:column>
                                        </p:dataTable>

                                    </div>
                                </p:outputPanel>
                                <p:outputPanel id="view1a" deferred="true" rendered="#{verificatorController.step eq 1}">
                                    <span class="instructions">Select one of these pre-loaded Dataset in order to verify the performance.<br/><br/>Or you can upload your own dataset in ARFF format. <p:commandButton actionListener="#{verificatorController.setStep(2)}" value="Upload Dataset" update=":form1"/></span>
                                    <span class="warning">The following Datatset were obtained from UCI repository and folded for cross validation.</span>
                                    <div>
                                        <p:accordionPanel value="#{verificatorController.preloadedSets}" var="preloadedSet" dynamic="true" cache="false" activeIndex="null">
                                            <p:tab title="#{preloadedSet.name}">
                                                <p:dataTable value="#{preloadedSet.files}" var="file"
                                                             selection="#{verificatorController.selectedSet}"
                                                        rowKey="#{file.id}">
                                                    <p:ajax event="rowSelectRadio" listener="#{verificatorController.onRowSelect}" />
                                                    <p:column selectionMode="single" style="width:2%" />
                                                    <p:column headerText="Training Set">
                                                        #{file.training}
                                                    </p:column>
                                                    <p:column headerText="Testing Set">
                                                        #{file.testing}
                                                    </p:column>
                                                    <p:column headerText="Original URL">
                                                        #{file.url}
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:accordionPanel>
                                    </div>
                                </p:outputPanel>
                                <p:outputPanel id="view2" deferred="true" rendered="#{verificatorController.step eq 2}">
                                    <span class="instructions">Upload your training and testing dataset in ARFF format (see arfflink).<br/><br/>Or your can try with the pre-loaded datasets. <p:commandButton actionListener="#{verificatorController.setStep(1)}" value="Pre-loaded Dataset" update=":form1"/></span>
                                    <span class="warning">When you upload both datasets, the ARFF must have the class in last column and it has to be a nominal value.</span>
                                    <div class="space"></div>
                                    <p:accordionPanel multiple="true">
                                        <p:tab title="Upload new training Dataset">
                                            <p:outputPanel styleClass="p">
                                                <small>(requerido</small>
                                                <label>Dataset: </label>
                                                <p:selectOneMenu value="#{verificatorController.trainName}" styleClass="field" id="files" style="width: 300px">
                                                    <f:selectItems value="#{verificatorController.fileManagerTrain.list()}" var="trainName"
                                                                   itemLabel="#{trainName}" itemValue="#{trainName}"/>
                                                </p:selectOneMenu>
                                            </p:outputPanel>
                                            <p:outputPanel styleClass="p">
                                                <p:fileUpload fileUploadListener="#{verificatorController.uploadFileTrain}" mode="advanced" dragDropSupport="false"
                                                              multiple="true"
                                                              uploadLabel="Upload ARFF"
                                                              cancelLabel="Cancel"
                                                              label="Select"
                                                              update=":form1:view2" sizeLimit="100000" fileLimit="3" allowTypes="/(\.|\/)(arff)$/" />
                                            </p:outputPanel>
                                        </p:tab>
                                    </p:accordionPanel>

                                    <div class="space"></div>

                                    <p:accordionPanel multiple="false">
                                        <p:tab title="Select the testing Dataset" id="i2">
                                            <p:outputPanel styleClass="p">
                                                <label>Dataset</label>
                                                <p:selectOneMenu value="#{verificatorController.testName}" styleClass="field" id="files2" style="width: 300px">
                                                    <f:selectItems value="#{verificatorController.fileManagerTest.list()}" var="testName"
                                                                   itemLabel="#{testName}" itemValue="#{testName}"/>
                                                </p:selectOneMenu>
                                            </p:outputPanel>
                                            <p:outputPanel styleClass="p">
                                                <p:fileUpload fileUploadListener="#{verificatorController.uploadFileTest}" mode="advanced" dragDropSupport="false"
                                                              multiple="true"
                                                              uploadLabel="Upload ARFF"
                                                              cancelLabel="Cancel"
                                                              label="Select"
                                                              update=":form1:view3" sizeLimit="100000" fileLimit="3" allowTypes="/(\.|\/)(arff)$/" />
                                            </p:outputPanel>
                                        </p:tab>
                                    </p:accordionPanel>

                                </p:outputPanel>
                                <p:outputPanel id="view3" deferred="true" rendered="#{verificatorController.step eq 3}">
                                    <span class="instructions">
                                        Results of classification:
                                        <h:panelGroup rendered="#{verificatorController.preloaded}" style="display: block; font-size: 24px; text-align: center"><br/>#{verificatorController.performance*100}%</h:panelGroup>
                                    </span>
                                    <p:dataTable var="resultClassification" value="#{verificatorController.resultClassify}"
                                                 rowStyleClass="white">
                                        <p:columns value="#{verificatorController.attributes}"
                                                   var="featureName" columnIndexVar="colIndex" styleClass="center">
                                            <f:facet name="header">
                                                #{featureName}
                                            </f:facet>
                                            #{resultClassification.pattern.get(colIndex)}
                                        </p:columns>
                                        <p:column headerText="Classified" styleClass="center" style="background-color: #{resultClassification.correct || !verificatorController.preloaded ? 'rgb(223, 240, 216);' : 'rgb(242, 222, 222);'}">
                                            #{verificatorController.className(resultClassification.pattern.classIndex)}
                                        </p:column>
                                        <p:column headerText="Real Class" styleClass="center" style="background-color: #{resultClassification.correct ? 'rgb(223, 240, 216);' : 'rgb(242, 222, 222);'}" rendered="#{verificatorController.preloaded}">
                                            #{verificatorController.className(resultClassification.realClass)}
                                        </p:column>
                                    </p:dataTable>
                                </p:outputPanel>

                                <!-- // Contenido -->
                            </p:outputPanel>
                        </div>
                        <div class="foot">
                            <p:outputPanel id="buttons">
                                <p:commandButton update=":form1" id="backBtn" disabled="#{verificatorController.step eq 0}" actionListener="#{verificatorController.back}" value="Back" />
                                <p:commandButton update=":form1" id="nextBtn" disabled="#{verificatorController.step eq 2}" actionListener="#{verificatorController.next}" rendered="#{verificatorController.step eq 0}" value="Next" styleClass="ui-button-success"/>
                                <p:commandButton update=":form1" process="@all" id="validateBtn" value="Classify" actionListener="#{verificatorController.proccess}" rendered="#{verificatorController.step eq 2 or verificatorController.step eq 1}" onstart="statusDialog.show();" onsuccess="statusDialog.hide();" />
                            </p:outputPanel>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div id="footer">
    </div>
    </h:form>


    <h:form prependId="false" id="form2">
        <p:outputPanel id="configsmNN">
            <p:dialog id="mNN" header="Configuración del clasificador mNN" widgetVar="mNNdlg" modal="true" height="50"
                      rendered="#{verificatorController.configureAlgorithm.name eq 'mNN'}" resizable="false">
                <p:outputPanel styleClass="p">
                    <label>Valor de m: </label>
                    <p:inputText value="#{verificatorController.configureAlgorithm.m}" styleClass="field" style="width: 300px" />
                </p:outputPanel>

                <f:facet name="footer">
                    <p:commandButton value="Guardar"
                                     oncomplete="mNNdlg.hide();"/>
                </f:facet>
            </p:dialog>
        </p:outputPanel>
        <p:outputPanel id="configskNN">
            <p:dialog id="kNN" header="Configuración del clasificador kNN" widgetVar="kNNdlg" modal="true" height="50"
                      rendered="#{verificatorController.configureAlgorithm.name eq 'kNN'}" resizable="false">
                <p:outputPanel styleClass="p">
                    <label>Valor de k: </label>
                    <p:inputText value="#{verificatorController.configureAlgorithm.k}" styleClass="field" style="width: 300px" />
                </p:outputPanel>

                <f:facet name="footer">
                    <p:commandButton value="Guardar"
                                     oncomplete="kNNdlg.hide();"/>
                </f:facet>
            </p:dialog>
        </p:outputPanel>
        <p:outputPanel id="configsEuclidean"></p:outputPanel>
        <p:outputPanel id="configsEuclideanMod"></p:outputPanel>
    </h:form>

    <p:dialog widgetVar="about" modal="true" height="310" resizable="false">
        <p:graphicImage url="about.png" />
    </p:dialog>

    <p:dialog modal="true" widgetVar="statusDialog" resizable="false" header="Clasificando Patrones"
              draggable="false" closable="false">
        <p:graphicImage value="/ajaxloadingbar.gif" />
    </p:dialog>
</h:body>
</html>